{% extends 'layouts/base.html' %}
{% block title %}{{pagetitle}}{% endblock %}
{% block content %}
{% load static %}
{% load currency_filters %}
{% load widget_tweaks %}
<section class="section bg-gray">
	<!-- Container Start -->
	<div class="container">
		<div class="row">
			<!-- Left sidebar -->
			<div class="col-lg-8">
				<div class="product-details">
					<h1 class="product-title">{{ property_data.name }}</h1>
					<div class="product-meta">
						<ul class="list-inline">
							<li class="list-inline-item"><i class="fa fa-folder-open-o"></i> Categoria<a href="category.html">{{property_data.get_ptype_display}}</a></li>
							<li class="list-inline-item"><i class="fa fa-location-arrow"></i> Comuna<a href="category.html">{{ property_data.comuna.nombre }}</a></li>
						</ul>
					</div>
                    <img src="{{ property_data.get_picture }}" class="img-fluid" alt="{{ property_data.name }}">
					<div class="content mt-5 pt-5">
						<ul class="nav nav-pills  justify-content-center" id="pills-tab" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home"
								 aria-selected="true">Descripcion</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile"
								 aria-selected="false">Especificaciones</a>
							</li> 
						</ul>
						<div class="tab-content" id="pills-tabContent">
							<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
								<h3 class="tab-title">Descripcion</h3>
								<p>{{ property_data.description }}</p>
							</div>
							<div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
								<h3 class="tab-title">Especificaciones</h3>
								<table class="table table-bordered product-table">
									<tbody>
										<tr>
											<td>M2 Totales</td>
											<td>{{ property_data.m2_total }}</td>
										</tr>
										<tr>
											<td>M2 Propiedad</td>
											<td>{{ property_data.m2_building }}</td>
										</tr>
										<tr>
											<td>Habitaciones</td>
											<td>{{ property_data.n_bedrooms }}</td>
										</tr>
										<tr>
											<td>Ba√±os</td>
											<td>{{ property_data.n_bathrooms }}</td>
										</tr>
										<tr>
											<td>Estacionamientos</td>
											<td>{{ property_data.n_parking }}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-4">
				<div class="sidebar">
					<div class="widget price text-center">
						<h4>Precio</h4>
						<p>{{ property_data.price|moneda }}</p>
					</div>
					<!-- User Profile widget -->
					<div class="widget user text-center">
						<h4><a>{{ property_data.landlord.get_full_name }}</a></h4>
						<p class="member-time">Miembro desde {{ property_data.landlord.date_joined|date:"j \d\e N Y" }}</p>
						<a href="single.html">Ver otras publicaciones</a>
						<ul class="list-inline mt-20">
                            {% if user.is_authenticated %}
							<li class="list-inline-item"><button class="btn btn-contact d-inline-block btn-primary px-lg-5 my-1 px-md-3" data-toggle="modal" data-target="#contactModal">Contactar</button></li>
                            {% else %}
							<li class="list-inline-item"><a href="{% url 'users:login' %}" class="btn btn-contact d-inline-block btn-primary px-lg-5 my-1 px-md-3">Iniciar Sesion</a></li>
                            {% endif %}
                        </ul>
					</div>

                    <div class="widget rate">
						<h5 class="widget-header text-center">Ultimos Contactos</h5>
						<ul class="list-group">
                            {% for request in requests %}
                            <li class="list-group-item">{{request.message}} de <span class="font-weight-bold">{{ request.user.get_full_name }}</span></li>
                            {% endfor %}
                          </ul>
					</div>
				</div>
			</div>

		</div>
	</div>
	<!-- Container End -->  
</section>
<div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
	  <div class="modal-content">
		<div class="modal-header">
		  <h1 class="modal-title fs-5" id="exampleModalLabel">Contactar</h1>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
		</div>
        {% if not has_contacted %}
		<form method="post">
			{% csrf_token %}
		<div class="modal-body">
				<div class="mb-3">
					<label for="contact_message" class="form-label">Mensaje</label>
					{% render_field request_form.message class="form-control" id="contact_message" placeholder="Nombre del Genero" required="" %}
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline" data-dismiss="modal">Cerrar</button>
				<button type="submit" class="btn btn-dark">Enviar</button>
			</div>
		</form>
        {% else %}
        <div class="alert alert-warning m-4" role="alert">
            Ya has contactado a este arrendador
          </div>
        {% endif %}
	  </div>
	</div>
  </div>
{% endblock %}